package com.studioannwn.output.ladybug;

import com.studioannwn.model.ladybug.LadybugModel;
import com.studioannwn.output.pixlite.PixLite;
import com.studioannwn.output.pixlite.PixLite4;
import heronarts.lx.LX;
import heronarts.lx.model.LXPoint;

import java.util.ArrayList;
import java.util.List;

public class LadybugLayout {
  private final static String PIXLITE_IP = "192.168.100.100";
  private final static int PIXLITE_OUTPUT = 1;

  /*
    logical // physical
   */
  private final static int[] POINT_MAPPING = {
    722, // 0
    667, // 1
    612, // 2
    523, // 3
    578, // 4
    633, // 5
    688, // 6
    743, // 7
    709, // 8
    654, // 9
    599, // 10
    544, // 11
    489, // 12
    434, // 13
    379, // 14
    324, // 15
    290, // 16
    345, // 17
    400, // 18
    455, // 19
    510, // 20
    565, // 21
    620, // 22
    675, // 23
    730, // 24
    696, // 25
    641, // 26
    586, // 27
    531, // 28
    476, // 29
    421, // 30
    366, // 31
    311, // 32
    256, // 33
    201, // 34
    167, // 35
    222, // 36
    277, // 37
    332, // 38
    387, // 39
    442, // 40
    497, // 41
    552, // 42
    607, // 43
    662, // 44
    717, // 45
    628, // 46
    573, // 47
    518, // 48
    463, // 49
    408, // 50
    353, // 51
    298, // 52
    243, // 53
    188, // 54
    133, // 55
    112, // 56
    78, // 57
    99, // 58
    154, // 59
    209, // 60
    264, // 61
    319, // 62
    374, // 63
    429, // 64
    484, // 65
    539, // 66
    594, // 67
    683, // 68
    738, // 69
    649, // 70
    704, // 71
    615, // 72
    560, // 73
    505, // 74
    450, // 75
    395, // 76
    340, // 77
    285, // 78
    230, // 79
    175, // 80
    141, // 81
    120, // 82
    86, // 83
    107, // 84
    162, // 85
    196, // 86
    251, // 87
    306, // 88
    361, // 89
    416, // 90
    471, // 91
    526, // 92
    581, // 93
    670, // 94
    725, // 95
    636, // 96
    691, // 97
    746, // 98
    712, // 99
    657, // 100
    602, // 101
    547, // 102
    492, // 103
    437, // 104
    382, // 105
    327, // 106
    272, // 107
    217, // 108
    183, // 109
    128, // 110
    94, // 111
    73, // 112
    52, // 113
    65, // 114
    44, // 115
    23, // 116
    10, // 117
    5, // 118
    18, // 119
    31, // 120
    39, // 121
    60, // 122
    81, // 123
    115, // 124
    149, // 125
    204, // 126
    238, // 127
    293, // 128
    348, // 129
    403, // 130
    458, // 131
    513, // 132
    568, // 133
    623, // 134
    678, // 135
    733, // 136
    699, // 137
    644, // 138
    589, // 139
    534, // 140
    479, // 141
    424, // 142
    369, // 143
    314, // 144
    259, // 145
    225, // 146
    280, // 147
    335, // 148
    390, // 149
    445, // 150
    500, // 151
    555, // 152
    610, // 153
    665, // 154
    720, // 155
    631, // 156
    576, // 157
    521, // 158
    466, // 159
    411, // 160
    356, // 161
    301, // 162
    246, // 163
    191, // 164
    170, // 165
    136, // 166
    102, // 167
    68, // 168
    47, // 169
    26, // 170
    13, // 171
    8, // 172
    21, // 173
    34, // 174
    55, // 175
    89, // 176
    123, // 177
    157, // 178
    212, // 179
    267, // 180
    322, // 181
    377, // 182
    432, // 183
    487, // 184
    542, // 185
    597, // 186
    686, // 187
    741, // 188
    652, // 189
    707, // 190
    618, // 191
    563, // 192
    508, // 193
    453, // 194
    398, // 195
    343, // 196
    288, // 197
    233, // 198
    178, // 199
    144, // 200
    199, // 201
    254, // 202
    309, // 203
    364, // 204
    419, // 205
    474, // 206
    529, // 207
    584, // 208
    673, // 209
    728, // 210
    639, // 211
    694, // 212
    749, // 213
    715, // 214
    660, // 215
    605, // 216
    550, // 217
    495, // 218
    440, // 219
    385, // 220
    330, // 221
    275, // 222
    220, // 223
    165, // 224
    110, // 225
    76, // 226
    42, // 227
    29, // 228
    16, // 229
    3, // 230
    11, // 231
    24, // 232
    37, // 233
    50, // 234
    63, // 235
    97, // 236
    131, // 237
    186, // 238
    152, // 239
    118, // 240
    84, // 241
    71, // 242
    58, // 243
    45, // 244
    32, // 245
    53, // 246
    66, // 247
    79, // 248
    92, // 249
    105, // 250
    139, // 251
    173, // 252
    207, // 253
    241, // 254
    296, // 255
    262, // 256
    228, // 257
    194, // 258
    160, // 259
    126, // 260
    113, // 261
    147, // 262
    181, // 263
    215, // 264
    249, // 265
    283, // 266
    317, // 267
    351, // 268
    406, // 269
    372, // 270
    338, // 271
    304, // 272
    270, // 273
    236, // 274
    202, // 275
    168, // 276
    134, // 277
    100, // 278
    87, // 279
    121, // 280
    155, // 281
    189, // 282
    223, // 283
    257, // 284
    291, // 285
    325, // 286
    359, // 287
    393, // 288
    427, // 289
    461, // 290
    516, // 291
    482, // 292
    448, // 293
    414, // 294
    380, // 295
    346, // 296
    312, // 297
    278, // 298
    244, // 299
    210, // 300
    176, // 301
    142, // 302
    163, // 303
    197, // 304
    231, // 305
    265, // 306
    299, // 307
    333, // 308
    367, // 309
    401, // 310
    435, // 311
    469, // 312
    503, // 313
    537, // 314
    571, // 315
    626, // 316
    592, // 317
    558, // 318
    524, // 319
    490, // 320
    456, // 321
    422, // 322
    388, // 323
    354, // 324
    320, // 325
    286, // 326
    341, // 327
    375, // 328
    409, // 329
    443, // 330
    477, // 331
    511, // 332
    545, // 333
    579, // 334
    613, // 335
    647, // 336
    681, // 337
    736, // 338
    702, // 339
    668, // 340
    723, // 341
    634, // 342
    689, // 343
    600, // 344
    566, // 345
    532, // 346
    498, // 347
    464, // 348
    430, // 349
    396, // 350
    485, // 351
    519, // 352
    553, // 353
    587, // 354
    621, // 355
    655, // 356
    744, // 357
    710, // 358
    676, // 359
    642, // 360
    608, // 361
    574, // 362
    629, // 363
    684, // 364
    718, // 365
    663, // 366
    697, // 367
    731, // 368
    739, // 369
    705, // 370
    650, // 371
    595, // 372
    540, // 373
    451, // 374
    506, // 375
    561, // 376
    616, // 377
    671, // 378
    726, // 379
    637, // 380
    582, // 381
    527, // 382
    472, // 383
    417, // 384
    362, // 385
    307, // 386
    252, // 387
    218, // 388
    273, // 389
    328, // 390
    383, // 391
    438, // 392
    493, // 393
    548, // 394
    603, // 395
    692, // 396
    747, // 397
    658, // 398
    713, // 399
    624, // 400
    569, // 401
    514, // 402
    459, // 403
    404, // 404
    349, // 405
    294, // 406
    239, // 407
    184, // 408
    205, // 409
    260, // 410
    315, // 411
    370, // 412
    425, // 413
    480, // 414
    535, // 415
    590, // 416
    679, // 417
    734, // 418
    645, // 419
    700, // 420
    611, // 421
    556, // 422
    501, // 423
    446, // 424
    391, // 425
    336, // 426
    281, // 427
    226, // 428
    171, // 429
    150, // 430
    129, // 431
    108, // 432
    95, // 433
    74, // 434
    40, // 435
    61, // 436
    82, // 437
    116, // 438
    137, // 439
    192, // 440
    247, // 441
    302, // 442
    357, // 443
    412, // 444
    467, // 445
    522, // 446
    577, // 447
    666, // 448
    721, // 449
    632, // 450
    687, // 451
    742, // 452
    708, // 453
    653, // 454
    598, // 455
    543, // 456
    488, // 457
    433, // 458
    378, // 459
    323, // 460
    268, // 461
    213, // 462
    158, // 463
    103, // 464
    124, // 465
    179, // 466
    234, // 467
    289, // 468
    344, // 469
    399, // 470
    454, // 471
    509, // 472
    564, // 473
    619, // 474
    674, // 475
    729, // 476
    640, // 477
    585, // 478
    530, // 479
    475, // 480
    420, // 481
    365, // 482
    310, // 483
    255, // 484
    200, // 485
    145, // 486
    166, // 487
    221, // 488
    276, // 489
    331, // 490
    386, // 491
    441, // 492
    496, // 493
    551, // 494
    606, // 495
    695, // 496
    750, // 497
    661, // 498
    716, // 499
    627, // 500
    572, // 501
    517, // 502
    462, // 503
    407, // 504
    352, // 505
    297, // 506
    242, // 507
    187, // 508
    132, // 509
    111, // 510
    90, // 511
    69, // 512
    48, // 513
    27, // 514
    19, // 515
    6, // 516
    14, // 517
    35, // 518
    56, // 519
    77, // 520
    98, // 521
    153, // 522
    208, // 523
    263, // 524
    318, // 525
    373, // 526
    428, // 527
    483, // 528
    538, // 529
    593, // 530
    682, // 531
    737, // 532
    648, // 533
    703, // 534
    614, // 535
    559, // 536
    504, // 537
    449, // 538
    394, // 539
    339, // 540
    284, // 541
    229, // 542
    174, // 543
    119, // 544
    140, // 545
    195, // 546
    250, // 547
    305, // 548
    360, // 549
    415, // 550
    470, // 551
    525, // 552
    580, // 553
    669, // 554
    724, // 555
    635, // 556
    690, // 557
    745, // 558
    711, // 559
    656, // 560
    601, // 561
    546, // 562
    491, // 563
    436, // 564
    381, // 565
    326, // 566
    271, // 567
    216, // 568
    161, // 569
    106, // 570
    85, // 571
    64, // 572
    43, // 573
    22, // 574
    30, // 575
    51, // 576
    72, // 577
    93, // 578
    127, // 579
    182, // 580
    237, // 581
    292, // 582
    347, // 583
    402, // 584
    457, // 585
    512, // 586
    567, // 587
    622, // 588
    677, // 589
    732, // 590
    698, // 591
    643, // 592
    588, // 593
    533, // 594
    478, // 595
    423, // 596
    368, // 597
    313, // 598
    258, // 599
    203, // 600
    148, // 601
    114, // 602
    80, // 603
    59, // 604
    38, // 605
    17, // 606
    9, // 607
    1, // 608
    4, // 609
    12, // 610
    25, // 611
    46, // 612
    67, // 613
    101, // 614
    135, // 615
    169, // 616
    224, // 617
    279, // 618
    334, // 619
    389, // 620
    444, // 621
    499, // 622
    554, // 623
    609, // 624
    664, // 625
    719, // 626
    630, // 627
    575, // 628
    520, // 629
    465, // 630
    410, // 631
    355, // 632
    300, // 633
    245, // 634
    190, // 635
    156, // 636
    122, // 637
    88, // 638
    54, // 639
    33, // 640
    20, // 641
    7, // 642
    2, // 643
    15, // 644
    28, // 645
    41, // 646
    75, // 647
    109, // 648
    143, // 649
    177, // 650
    211, // 651
    266, // 652
    321, // 653
    376, // 654
    431, // 655
    486, // 656
    541, // 657
    596, // 658
    651, // 659
    685, // 660
    740, // 661
    706, // 662
    617, // 663
    562, // 664
    507, // 665
    452, // 666
    397, // 667
    342, // 668
    287, // 669
    232, // 670
    198, // 671
    253, // 672
    308, // 673
    363, // 674
    418, // 675
    473, // 676
    528, // 677
    583, // 678
    638, // 679
    672, // 680
    727, // 681
    693, // 682
    748, // 683
    714, // 684
    659, // 685
    604, // 686
    549, // 687
    494, // 688
    439, // 689
    384, // 690
    329, // 691
    274, // 692
    219, // 693
    164, // 694
    130, // 695
    185, // 696
    240, // 697
    295, // 698
    350, // 699
    405, // 700
    460, // 701
    515, // 702
    570, // 703
    625, // 704
    680, // 705
    735, // 706
    701, // 707
    646, // 708
    591, // 709
    536, // 710
    481, // 711
    426, // 712
    371, // 713
    316, // 714
    261, // 715
    206, // 716
    151, // 717
    117, // 718
    96, // 719
    62, // 720
    83, // 721
    104, // 722
    138, // 723
    172, // 724
    227, // 725
    282, // 726
    337, // 727
    392, // 728
    447, // 729
    502, // 730
    557, // 731
    468, // 732
    413, // 733
    358, // 734
    303, // 735
    248, // 736
    193, // 737
    159, // 738
    214, // 739
    269, // 740
    235, // 741
    180, // 742
    146, // 743
    125, // 744
    91, // 745
    70, // 746
    49, // 747
    36, // 748
    57 // 749
  };

  private final LadybugModel model;
  private PixLite pixlite;

  public LadybugLayout() {
    model = new LadybugModel();

    System.out.println(String.format(
      "Model stats: \n\tcx=%f \tcy=%f \tcz=%f\n\txAvg=%f \tyAvg=%f \tzAvg=%f\n\txRange=%f \tyRange=%f \tzRange=%f\n",
      model.cx, model.cy, model.cz, model.ax, model.ay, model.az, model.xRange, model.yRange, model.zRange));
  }

  public void addOutputs(LX lx) {
    List<LXPoint> physicalPoints = mapLogicalPointsToPhysicalPoints();

    pixlite = new PixLite4(lx, PIXLITE_IP);
    pixlite.addOutput(PIXLITE_OUTPUT, physicalPoints);

    lx.addOutput(pixlite);
  }

  private List<LXPoint> mapLogicalPointsToPhysicalPoints() {
    List<LXPoint> logicalPoints = model.getPoints();
    List<LXPoint> physicalPoints = new ArrayList<>(logicalPoints.size());

    for (int i=0; i < logicalPoints.size(); i++) {
      physicalPoints.add(logicalPoints.get(POINT_MAPPING[i] - 1)); // note the -1
    }

    return physicalPoints;
  }

  public LadybugModel getModel() {
    return model;
  }
}
